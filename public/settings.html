<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Journey :: Events</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<link rel="stylesheet" type="text/css" href="css/events.css">
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script>// Client ID and API key from the Developer Console
var CLIENT_ID = '551111354834-nfns5goompgkjpch7eu55mrj9nrp3ofd.apps.googleusercontent.com';

// Array of API discovery doc URLs for APIs used by the quickstart
var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

// Authorization scopes required by the API; multiple scopes can be
// included, separated by spaces.
var SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

/**
 *	On load, called to load the auth2 library and API client library.
 */
function handleClientLoad() {
	gapi.load('client:auth2', initClient);
}

/**
 *	Initializes the API client library and sets up sign-in state
 *	listeners.
 */
function initClient() {
	gapi.client.init({
		discoveryDocs: DISCOVERY_DOCS,
		clientId: CLIENT_ID,
		scope: SCOPES
	}).then(function () {
		console.log('is 33 in');
		// Listen for sign-in state changes.
		gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

		// Handle the initial sign-in state.
		updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
		$('#authorize-button,#signout-button').click(function(){
			var type = $(this).attr('id');
			handleAuthClick(type);
		});
		console.log('is 47 in');
	});
}

/**
 *	Called when the signed in status changes, to update the UI
 *	appropriately. After a sign-in, the API is called.
 */
function updateSigninStatus(isSignedIn) {
		console.log('55');
	if (isSignedIn) {
		//Redirect user to the correct page
		$('#authorize-button').hide();
		$('#signout-button').show();
		console.log('is signed in');
		populateCalendarList();
	} else {
		//Show user the splash page
		$('#authorize-button').show();
		$('#signout-button').hide();
	}
}

/**
 *	Sign in the user upon button click.
 */
function handleAuthClick(type) {
	if (type == 'authorize-button'){
		gapi.auth2.getAuthInstance().signIn();
	}
	else if (type == 'signout-button'){
		gapi.auth2.getAuthInstance().signOut();
	}
}
/*function signInUser(){
	
	var GoogleUser = gapi.auth2.getAuthInstance().currentUser.get();
	var id_token = GoogleUser.getAuthResponse().id_token;
	
	
	$.ajax({
		method: "POST",
		url: "tokensignin",
		data: { idtoken:id_token }
	}).done(function( msg ) {
		$('body').html( msg );
	});
}*/
function populateCalendarList(){
	function listUpcomingEvents() {
		gapi.client.calendar.calendarList.list({
			'showDeleted': false,
			'maxResults': 50
		}).then(function(response) {
			console.log(JSON.stringify(response.result));
			/*var calendarList = response.result.items;
			appendPre('Upcoming events:');

			if (events.length > 0) {
				for (i = 0; i < events.length; i++) {
					var event = events[i];
					var when = event.start.dateTime;
					if (!when) {
						when = event.start.date;
					}
					appendPre(event.summary + ' (' + when + ')')
				}
			} else {
				appendPre('No upcoming events found.');
			}*/
		});
	}
}
		</script>
		<script type="text/javascript" src="js/main.js"></script>
		<script type="text/javascript" src="js/events.js"></script>
		
	</head>
	<body>
		<div id="main_header">
			<div id="title">Journey</div>
		</div>
		<div id="main_body">
			<div id="left_col">
				<div id="icons">
					<a id="homeIcon" href="events.html"></a><a id="calIcon" href="calendar.html"></a><a id="addIcon" href="add.html"></a>
					<ul>
						<li>Personal Settings</li>
						<li>Select Calendars</li>
						<li>Delete Account</li>
					<ul>
				</div>
				<div id="search"><input type="text" name="search" value="Search"/></div>
				
			</div>
			<div id="right_col">
				<h3>Select Calendars</h3>
				Please select the calendars you would like to use:
				
			</div>
		</div>
		<div id="footer">
			<span class="username">Hi, {{name}}</span>
			<span><a class="foot_cont">Settings</a> | <a class="foot_cont">Logout</a></span>
		</div>
	</body>
</html>